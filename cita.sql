-- MySQL Script generated by MySQL Workbench
-- 05/10/16 00:42:00
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema cita
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `cita` ;

-- -----------------------------------------------------
-- Schema cita
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `cita` DEFAULT CHARACTER SET utf8 ;
USE `cita` ;

-- -----------------------------------------------------
-- Table `cita`.`cliente`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`cliente` ;

CREATE TABLE IF NOT EXISTS `cita`.`cliente` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NULL,
  `apellido1` VARCHAR(45) NULL,
  `apellido2` VARCHAR(45) NULL,
  `telefono` INT NULL,
  `codigo_postal` INT NULL,
  `email` VARCHAR(128) NULL,
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modifiacion` DATETIME NULL,
  `password` VARCHAR(255) NOT NULL COMMENT 'encriptada',
  `vivo` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `imagen` VARCHAR(255) NULL,
  `codigo_activacion` VARCHAR(255) NOT NULL COMMENT 'codigo aleatoreo generado con los datos personales por semilla Se envia al cliente por correo para que active su cuenta',
  `activado` TINYINT NOT NULL DEFAULT 0 COMMENT 'cuenta activa',
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cita`.`estado`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`estado` ;

CREATE TABLE IF NOT EXISTS `cita`.`estado` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(255) NULL,
  `vivo` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cita`.`cita`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`cita` ;

CREATE TABLE IF NOT EXISTS `cita`.`cita` (
  `fecha_cita` DATETIME NOT NULL,
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  `vivo` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `fecha_cal_recogida` DATETIME NULL COMMENT 'fecha de recogida estimada calculada y mostrada al usuario',
  `fecha_gusto_recogida` DATETIME NULL COMMENT 'momento en el que le gustaria recoger al usuario',
  `precio_cal` INT NULL COMMENT 'precio que se le dio al cliente al calcular la cita',
  `observaciones` VARCHAR(255) NULL COMMENT 'campo opcional para describir la bici o bicis que traiga el usuario',
  `estado_id` INT NOT NULL DEFAULT 1 COMMENT 'estado de la reparacion',
  `cliente_id` INT NOT NULL,
  PRIMARY KEY (`fecha_cita`),
  INDEX `fk_cita_estado1_idx` (`estado_id` ASC),
  INDEX `fk_cita_cliente1_idx` (`cliente_id` ASC),
  CONSTRAINT `fk_cita_estado1`
    FOREIGN KEY (`estado_id`)
    REFERENCES `cita`.`estado` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_cita_cliente1`
    FOREIGN KEY (`cliente_id`)
    REFERENCES `cita`.`cliente` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = '						';


-- -----------------------------------------------------
-- Table `cita`.`marca_pieza`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`marca_pieza` ;

CREATE TABLE IF NOT EXISTS `cita`.`marca_pieza` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `imagen` VARCHAR(255) NULL,
  `vivo` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `nombre_UNIQUE` (`nombre` ASC))
ENGINE = InnoDB
COMMENT = '		';


-- -----------------------------------------------------
-- Table `cita`.`pieza`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`pieza` ;

CREATE TABLE IF NOT EXISTS `cita`.`pieza` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `precio` INT NOT NULL,
  `precio_instalar` INT NOT NULL,
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  `vivo` TINYINT NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `marca_pieza_id` INT NOT NULL,
  `imagen` VARCHAR(255) NULL,
  `observaciones` VARCHAR(255) NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_pieza_marca_pieza1_idx` (`marca_pieza_id` ASC),
  CONSTRAINT `fk_pieza_marca_pieza1`
    FOREIGN KEY (`marca_pieza_id`)
    REFERENCES `cita`.`marca_pieza` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
COMMENT = '				';


-- -----------------------------------------------------
-- Table `cita`.`mano`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`mano` ;

CREATE TABLE IF NOT EXISTS `cita`.`mano` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `coste` INT NOT NULL,
  `minutos_duracion` INT NOT NULL,
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  `vivo` TINYINT NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `imagen` VARCHAR(255) NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `nombre_UNIQUE` (`nombre` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cita`.`otro`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`otro` ;

CREATE TABLE IF NOT EXISTS `cita`.`otro` (
  `nombre` VARCHAR(45) NOT NULL,
  `valor` VARCHAR(45) NULL COMMENT 'por ejemplo para guardar el iva actual',
  `vivo` TINYINT(1) NOT NULL DEFAULT 1,
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  PRIMARY KEY (`nombre`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cita`.`handicap`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`handicap` ;

CREATE TABLE IF NOT EXISTS `cita`.`handicap` (
  `id` INT NOT NULL COMMENT 'una cita puede tener varios handicaps La misma cantidad de handicaps que de manos de obra',
  `nombre` VARCHAR(45) NULL,
  `recargo` VARCHAR(45) NULL,
  `minutos_duracion` INT NULL COMMENT 'en minutos',
  `imagen` VARCHAR(255) NULL,
  `vivo` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'campo que dice si esta no borrado o borrado el registro',
  `fecha_creacion` DATETIME NOT NULL,
  `fecha_modificacion` DATETIME NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cita`.`cita_has_mano`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`cita_has_mano` ;

CREATE TABLE IF NOT EXISTS `cita`.`cita_has_mano` (
  `cita_fecha_cita` DATETIME NOT NULL,
  `mano_id` INT NOT NULL,
  `handicap_id` INT NOT NULL,
  PRIMARY KEY (`cita_fecha_cita`, `mano_id`),
  INDEX `fk_cita_has_mano_mano1_idx` (`mano_id` ASC),
  INDEX `fk_cita_has_mano_cita1_idx` (`cita_fecha_cita` ASC),
  INDEX `fk_cita_has_mano_handicap1_idx` (`handicap_id` ASC),
  CONSTRAINT `fk_cita_has_mano_cita1`
    FOREIGN KEY (`cita_fecha_cita`)
    REFERENCES `cita`.`cita` (`fecha_cita`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_cita_has_mano_mano1`
    FOREIGN KEY (`mano_id`)
    REFERENCES `cita`.`mano` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_cita_has_mano_handicap1`
    FOREIGN KEY (`handicap_id`)
    REFERENCES `cita`.`handicap` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cita`.`cita_has_pieza`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `cita`.`cita_has_pieza` ;

CREATE TABLE IF NOT EXISTS `cita`.`cita_has_pieza` (
  `cita_fecha_cita` DATETIME NOT NULL,
  `pieza_id` INT NOT NULL,
  `cantidad` INT NOT NULL DEFAULT 1 COMMENT 'cantidad de piezas por cita',
  PRIMARY KEY (`cita_fecha_cita`, `pieza_id`),
  INDEX `fk_cita_has_pieza_pieza1_idx` (`pieza_id` ASC),
  INDEX `fk_cita_has_pieza_cita1_idx` (`cita_fecha_cita` ASC),
  CONSTRAINT `fk_cita_has_pieza_cita1`
    FOREIGN KEY (`cita_fecha_cita`)
    REFERENCES `cita`.`cita` (`fecha_cita`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_cita_has_pieza_pieza1`
    FOREIGN KEY (`pieza_id`)
    REFERENCES `cita`.`pieza` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
